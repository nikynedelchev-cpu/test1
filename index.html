<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Револвер</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #111;
      color: #f5f5f5;
      font-family: system-ui, Arial, sans-serif;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
    }

    .reel-container {
      margin-top: 20px;
      border-radius: 16px;
      padding: 8px;
      background: #222;
      border: 1px solid #555;
    }

    .reel {
      width: 100%;
      height: 200px;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
      border-radius: 12px;
      background: #000;
    }

    .reel-item {
      padding: 18px;
      text-align: center;
      font-size: 1.3rem;
      scroll-snap-align: center;
      border-bottom: 1px solid #222;
      cursor: pointer;
    }

    .reel-item:hover {
      background: #333;
    }

    .current-box {
      margin-top: 20px;
      padding: 12px;
      border-radius: 12px;
      background: #1f2933;
      font-size: 1rem;
    }

    .log-container {
      margin-top: 20px;
    }

    .log-entry {
      padding: 10px;
      border-radius: 10px;
      background: #151b20;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    .log-entry-duration {
      color: #facc15;
      font-size: 0.9rem;
    }

    .sleep-info {
      margin-top: 10px;
      padding: 10px;
      border-radius: 10px;
      background: #1d3b25;
      font-size: 0.95rem;
      color: #bbf7d0;
    }
  </style>
</head>

<body>
  <div class="app">

    <div class="reel-container">
      <div id="reel" class="reel"></div>
    </div>

    <div class="current-box">
      <b>Текуща активност:</b>
      <div id="currentActivityText">няма</div>
    </div>

    <div id="sleepInfo" class="sleep-info" style="display:none;"></div>

    <div class="log-container">
      <h2>Лог</h2>
      <div id="logList"></div>
    </div>

  </div>

  <script>
    const activities = [
      "Закуска",
      "Обед",
      "Вечеря",
      "Фитнес",
      "Ставане",
      "Лягане",
      "Работа",
      "Почивка",
      "Филм",
      "Цигара"
    ];

    const reel = document.getElementById("reel");
    const currentActivityText = document.getElementById("currentActivityText");
    const logList = document.getElementById("logList");
    const sleepInfo = document.getElementById("sleepInfo");

    // Populate items
    activities.forEach(name => {
      const item = document.createElement("div");
      item.className = "reel-item";
      item.textContent = name;
      item.addEventListener("click", () => selectActivity(name));
      reel.appendChild(item);
    });

    let currentEntry = null;
    const logEntries = [];

    function formatTime(d) {
      return d.toLocaleTimeString("bg-BG", { hour: "2-digit", minute: "2-digit" });
    }

    function formatDuration(ms) {
      const min = Math.floor(ms / 60000);
      const h = Math.floor(min / 60);
      const rm = min % 60;
      return h > 0 ? `${h} ч ${rm} мин` : `${rm} мин`;
    }

    function renderLog() {
      logList.innerHTML = "";
      [...logEntries].reverse().forEach(entry => {
        const div = document.createElement("div");
        div.className = "log-entry";

        div.innerHTML = `
          <b>${entry.name}</b><br>
          от ${formatTime(entry.start)} до ${formatTime(entry.end)}<br>
          <span class="log-entry-duration">Продължителност: ${formatDuration(entry.end - entry.start)}</span>
        `;

        logList.appendChild(div);
      });
    }

    function selectActivity(name) {
      const now = new Date();
      sleepInfo.style.display = "none";

      // close previous
      if (currentEntry) {
        const e = { name: currentEntry.name, start: currentEntry.start, end: now };
        logEntries.push(e);

        if (currentEntry.name === "Лягане" && name === "Ставане") {
          sleepInfo.innerHTML = `Сън: ${formatDuration(e.end - e.start)}<br>${formatTime(e.start)} → ${formatTime(e.end)}`;
          sleepInfo.style.display = "block";
        }

        renderLog();
      }

      // start new
      currentEntry = { name, start: now };
      currentActivityText.textContent = `${name} (от ${formatTime(now)})`;
    }
  </script>

</body>
</html>
